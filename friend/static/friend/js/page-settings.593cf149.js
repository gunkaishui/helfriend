(function(z){
var iU=function(){z.Q.call(this)};var jU=function(a){z.Uh.set("SettingsAccountPage:pageAlert",a);window.location.reload()};var kU=function(a){return window.$.extend(!0,{},{messages:z.dz,ignore:"input.text:hidden"},a)};
var lU=function(a,b){function c(a){return!a.success&&a.payload}function d(){O.addClass("expanded");a.trigger("expanded")}function f(b){O.removeClass("expanded");b&&O.find(".group-text .text").text(b);a.removeClass("form-expanded");a.trigger("collapsed");a.find(":input:not(:submit)").each(function(){this.value=this.defaultValue});K.text(K.data("defaultText"));I.text("")}function g(){return window.$.Deferred(function(b){ba&&!a.hasClass("form-expanded")&&a.valid()?(a.addClass("form-expanded"),w.click(),
K.data("defaultText",K.text()).text("纭畾"),b.reject()):b.resolve()}).promise()}function h(){return p.submit(a.serialize())}function k(a){a.fields?Ua.showErrors(a.fields):a.message&&z.W.message(a.message)}function l(a){var b=a.payload;a.success?(b&&f(b[q.attr("name")]),p.bv()):k(b)}var p=window.$.extend({RF:10,zC:window.$.noop,AC:"",submit:window.$.noop,bv:window.$.noop,MZ:{email:{promise:[mU.KZ,200,c]},phone_no:{promise:[mU.LZ,200,c]}}},b),q=(0,window.$)("input.text:first",a),w=(0,window.$)(".js-send-digits",
a),I=(0,window.$)(".hint-label-container",a),K=(0,window.$)(":submit",a),O=a.closest(".form-container"),ba=!!w.length,Ua;(function(){(0,window.$)(".js-expand:not(.disabled)",O).click(z.Xq(function(){z.cz().then(d);return!1},!0));ba&&z.tk(w,p.RF,nU,function(){if(!q.valid())return!1;I.text("");p.zC(q.val()).then(function(a){a.success?I.text(p.AC):k(a.payload)})});Ua=a.validate(kU({rules:p.MZ,errorPlacement:function(a,b){b.is(":visible")&&a.appendTo(b.parent())},submitHandler:z.uk(K,function(){return z.cz().then(g).then(h).then(l)})}))})()};
var nU=function(a){return a?"%s 绉掑悗鍗冲彲閲嶅彂":"閲嶅彂楠岃瘉鐮�"};var oU=function(a){a=(0,window.$)(".email-form",a.h);if(a.length){lU(a,{AC:"楠岃瘉鐮佸凡鍙戦€佽嚦浣犵殑閭",zC:mU.hY,submit:mU.zZ,bv:z.Ba(jU,"閭缁戝畾鎴愬姛")});a.on("expanded",function(){(0,window.$)(".email-activation-notice").remove()});a=function(){window.$.post("/reactive").done(function(a){a.r?z.nG(a.msg,"error"):z.nG("楠岃瘉閭欢閲嶅彂鎴愬姛")})};var b=(0,window.$)(".resend-activation-email");if(b.length){var c=b.text();z.tk(b,10,function(a){return a?c+"锛�%s锛�":c},a)}}};
var pU=function(a){a=(0,window.$)(".phone-form",a.h);if(a.length){lU(a,{RF:60,AC:"楠岃瘉鐮佸凡鍙戦€佽嚦浣犵殑鎵嬫満",zC:mU.iY,submit:mU.DZ,bv:z.Ba(jU,"鎵嬫満缁戝畾鎴愬姛")});var b=(0,window.$)(".js-countries-selector");window.$.get("/sms_supported_countries",function(a){var d=[];a.countries.forEach(function(a){d.push('\x3coption value\x3d"'+a.code+'" data-abbr\x3d"'+a.abbr+'"\x3e'+a.name+" +"+a.code+"\x3c/option\x3e")});b.html(d.join(""))})}};
var qU=function(a){var b=(0,window.$)(".sns-accounts-container",a.h);if(b.length){var c=function(a,c){var f=(0,window.$)(z.Ja("a[data-type\x3d%s]",a),b);c?jU(window.$.trim(z.Ja("%s缁戝畾鎴愬姛",d(a)))):f.text(window.$.trim(z.Ja("缁戝畾%s",d(a)))).removeClass("js-unbind").addClass("js-bind").prev(".name").remove()},d=function(a){return{qqconn:" QQ ",wechat:"寰俊",sina:"寰崥",wechat_mp:"寰俊"}[a]};b.on("click","a.js-bind",function(){var a=this.href;z.cz().then(function(){window.open(a)});return!1});b.on("click","a.js-unbind",
function(a){function b(){return new window.Promise(function(a,b){z.W.confirm({modal:!0,title:"瑙ｇ粦甯愬彿",content:"鐢变簬浣犳病鏈夎缃叾浠栫櫥褰曟柟寮忋€傝В闄�"+l+'缁戝畾鍚庯細\x3cul style\x3d"padding-left:26px;"\x3e\x3cli\x3e\x3cb\x3e浣犲皢姘镐箙鏃犳硶鍐嶇櫥褰曟甯愬彿锛屼笖姝ゆ搷浣滀笉鍙挙閿€銆俓x3c/b\x3e\x3c/li\x3e\x3cli\x3e浣犵殑涓汉涓婚〉璧勬枡鍜屽姩鎬佷粛浼氫繚鐣欍€俓x3c/li\x3e'+("\x3cli\x3e浣犲彲浠ヤ娇鐢ㄥ叾浠栫煡涔庡笎鍙风粦瀹氭"+l+"甯愬彿銆俓x3c/li\x3e")+"\x3c/ul\x3e纭畾瑙ｇ粦鍚楋紵",buttons:{yes:"纭畾瑙ｇ粦"}},function(c){if(!c)return a(!1);window.$.post("/oauth/close_account/"+f,function(c){if(c.r)return b(c.msg);a(!0)})})})}a.preventDefault();
var f=(0,window.$)(a.currentTarget).data("type"),l=d(f);z.W.confirm({modal:!0,title:"瑙ｇ粦绀句氦甯愬彿",content:"瑙ｇ粦"+l+"鍚庝綘灏嗘棤娉曚娇鐢�"+l+"鐧诲綍鐭ヤ箮锛屼綘纭畾瑕佽В缁戝悧锛�",buttons:{yes:"瑙ｇ粦"}},function(a){a&&(0,window.setTimeout)(function(){z.cz().then(function(){return mU.qZ(f)}).then(function(){z.nG("瑙ｇ粦"+l+"鎴愬姛");c(f,!1)},function(a){if("ERR_NEED_LOGIN_NAME"===a)return b();throw a;}).then(function(a){a&&(window.location.pathname="/")},function(){return rU.message("瑙ｇ粦澶辫触锛岃鍒锋柊椤甸潰閲嶈瘯銆�")})})})});var f=function(a){return function(b){"error"===
a?(0,window.setTimeout)(function(){z.nG(b.Uf.message,"error",6E3)},3E3):c(a,!0)}};a.o().g(z.X,"sina_callback",f("sina")).g(z.X,"qqconn_callback",f("qqconn")).g(z.X,"wechat_callback",f("wechat")).g(z.X,"oauth_error_callback",f("error"))}};var sU=function(){z.Q.call(this)};var tU=function(a){var b=window.$.Deferred();z.W.confirm("鍙栨秷灞忚斀",a,function(a){a?b.resolve():b.reject()});return b.promise()};
var uU=function(a){var b=(0,window.$)(".blocked-users",a.m());if(b.length)(0,window.$)(".item",b).on("click",".js-unblock",function(a){var d=(0,window.$)(a.delegateTarget);tU("鍙栨秷灞忚斀涔嬪悗锛屽鏂瑰皢鍙互锛氬叧娉ㄤ綘銆佺粰浣犲彂绉佷俊銆佸悜浣犳彁闂€佽瘎璁轰綘鐨勭瓟妗堛€侀個璇蜂綘鍥炵瓟闂銆�").then(function(){return window.$.post("/settings/unblockuser",{uid:d.data("id")})}).then(function(){d.fadeOut(function(){d.remove()});b.children().length||window.location.reload()})})};
var vU=function(a){var b=(0,window.$)(".blocked-columns",a.m());if(b.length)(0,window.$)(".item",b).on("click",".js-unblock",function(a){var d=(0,window.$)(a.delegateTarget);tU("鍙栨秷灞忚斀涔嬪悗锛屼綘灏嗗彲浠ョ湅鍒版潵鑷涓撴爮鐨勬枃绔犮€�").then(function(){return window.$.post("/settings/unblockcolumn",{id:d.data("id")})}).then(function(){d.fadeOut(function(){d.remove()});b.children().length||window.location.reload()})})};var wU=function(){z.Q.call(this)};
var xU=function(){function a(a,b){var c={method:"save",params:{settings:a}};window.$.extend(c.params,f);window.$.post("/node/NotiEmailSettingsV2",c,function(a){var c;a.r?c="error":(b&&b(),c="success");var d=(0,window.$)(".settings-msg-"+c);d.length?d.show():(d=(0,window.$)('\x3cdiv class\x3d"settings-msg-'+c+'"\x3e'+a.msg+"\x3c/div\x3e"),d.appendTo((0,window.$)("body")));d.delay(1E3).fadeOut()})}var b=z.vm.hasEmail,c=z.vm.mailActivated,d=!1,f=z.vm.settings_unsubscribe_formdata;f||(d=!c);(0,window.$)('.settings-receive input[type\x3d"radio"]').on("change",
function(){if(this.checked){var b=(0,window.$)(this),c={type:b.closest(".settings-item").data("type"),noti:b.val()};"no"===c.noti?a(c,function(){b.closest(".settings-receive").next(".settings-mail").addClass("disabled").find('input[type\x3d"checkbox"]').prop("disabled",!0)}):a(c,function(){b.closest(".settings-receive").next(".settings-mail").removeClass("disabled").find('input[type\x3d"checkbox"]').prop("disabled",!1)})}});(0,window.$)('.settings-mail input[type\x3d"checkbox"]').on("click",function(a){d&&
(a.preventDefault(),a="婵€娲�",b||(a="缁戝畾"),z.W.confirm({title:"鎻愮ず",content:"寮€鍚€氱煡閭欢鍓嶏紝璇峰厛"+a+"閭銆�",buttons:{yes:"鍘�"+a+"閭"}},function(a){a&&window.open("/settings/account")}))});(0,window.$)('.settings-stranger-inbox input[type\x3d"checkbox"]').on("change",function(){var b={type:(0,window.$)(this).closest(".settings-item").data("type"),stranger:this.checked};a(b)});(0,window.$)('.settings-mail input[type\x3d"checkbox"]').on("change",function(){if(!d){var b={type:(0,window.$)(this).closest(".settings-item").data("type"),
mail:this.checked};a(b)}});(0,window.$)("#settings-fast-answer").on("change",function(){var b={type:(0,window.$)(this).closest(".settings-item").data("type"),fast:this.checked};a(b)});(0,window.$)(".settings-msg-disappear").delay(3E3).fadeOut()};
var yU=function(){var a=(0,window.$)(".js-ajax-form");a.submit(function(b){var d=(0,window.$)(b.target);b=d.attr("action")||window.location.href;window.$.post(b,d.serialize()).done(function(b){z.oG(z.Gb(b),5E3);d.hasClass("unsubscribe")&&(a.remove(),(0,window.$)(".settings-section").remove())});return!1});(0,window.$)(".js-unsubscribe-other-reason").on("change",function(a){(0,window.$)(a.target).parent().siblings().find(".zg-form-text-input").toggle()});var b=(0,window.$)(".feedback-form");b.submit(function(){var a=
b.attr("action");window.$.post(a,b.serialize()).done(function(){b.before('\x3cdiv style\x3d"font-size:13px;color:black;margin-bottom:20px"\x3e鎰熻阿鎮ㄧ殑鍙嶉锛乗x3c/div\x3e\x3ca href\x3d"/"\x3e\x26laquo; 杩斿洖鐭ヤ箮\x3c/a\x3e');b.remove()});return!1})};
var zU=function(){var a=(0,window.$)("#js-form-account-password");a.length&&((0,window.$)("input[placeholder]",a).each(function(){new z.vk(this)}),a.validate({messages:{np:{required:'\x3ci class\x3d"icon icon-validate-error"\x3e\x3c/i\x3e鏂板瘑鐮佹湭濉啓'},op:{required:'\x3ci class\x3d"icon icon-validate-error"\x3e\x3c/i\x3e鏃у瘑鐮佹湭濉啓'},rp:{required:'\x3ci class\x3d"icon icon-validate-error"\x3e\x3c/i\x3e纭瀵嗙爜鏈～鍐�'}},errorClass:"validate-error"}))};
var AU=function(){(0,window.$)("#weibopageenable").on("change",function(a){window.$.post("/node/SettingsWeiboPageV2",{method:a.target.checked?"enable":"disable"}).done(function(a){a.r?z.W.message(a.msg):z.oG([!1,"淇濆瓨鎴愬姛"])});return!1})};var BU=function(){var a=z.J("zh-setting-page-black-list-wrap");a&&(new sU).w(a)};
var CU=function(){var a=(0,window.$)("#js-settings-account-form");if(a.length){var b=(0,window.$)("#url_token"),c=(0,window.$)("#js-url-preview .token");b.on("input change keyup",function(){c.text(window.$.trim(this.value))});DU(a);var b=new z.Cy,d=(0,window.$)(".rename-tab",a);b.w(d.get(0));var f=function(){(0,window.$)("input[placeholder]:visible",d).placeholder()};b.on("select",f);var g=(0,window.$)(".rename-button",a),a=z.Xq(function(){g.remove();d.removeClass("hidden");f()},[!0,{VK:!1}]);g.one("click",
a);"#rename-section"===window.location.hash&&a()}};var DU=function(a){(0,window.$)(".zg-form-text-input",a).each(function(){function a(){this.value!==this.defaultValue&&(d.hide(),c.off("change input keyup",a))}var c=(0,window.$)(this),d=c.next(".validate-error");if(d.length)c.on("change input keyup",a)})};var rU={};z.y(iU,z.Q);z.x("ZH.ui.SettingsAccountPage",iU);
var mU={Aj:"/settings/account/",KZ:function(a){return window.$.post(mU.Aj+"validate_email",a)},LZ:function(a){a.phone_no="+"+(0,window.$)(".js-countries-selector").val()+a.phone_no;return window.$.post(mU.Aj+"validate_phone",a)},hY:function(a){return window.$.post(mU.Aj+"send_new_email_digits",{email:a})},iY:function(a){a="+"+(0,window.$)(".js-countries-selector").val()+a;return window.$.post(mU.Aj+"send_new_phone_digits",{phone_no:a})},CZ:function(a){return window.$.post(mU.Aj+"update_password",
a)},zZ:function(a){return window.$.post(mU.Aj+"update_email",a)},DZ:function(a){return window.$.post(mU.Aj+"update_phone",a)},qZ:function(a){return new window.Promise(function(b,c){window.$.post("/oauth/unbind/"+a,function(a){if(a.r)return c(a.msg);b()})})}};iU.prototype.C=function(){iU.v.C.call(this);oU(this);pU(this);var a=(0,window.$)(".password-form",this.h);a.length&&lU(a,{submit:mU.CZ,bv:z.Ba(jU,"瀵嗙爜璁剧疆鎴愬姛")});qU(this);if(a=z.Uh.get("SettingsAccountPage:pageAlert"))z.nG(a),z.Uh.remove("SettingsAccountPage:pageAlert")};z.y(sU,z.Q);sU.prototype.C=function(){sU.v.C.call(this);var a=z.J("zh-topic-block-editor");a&&(new z.Yt(z.pm)).w(a);uU(this);vU(this)};z.n(wU,z.Q);wU.prototype.init=function(){var a=this;xU();yU();AU();CU();zU();BU();(0,window.$)(".zu-main-content-inner form").on("change","input, textarea, select",function(){a.Iy("SettingsPage")}).on("submit",function(){a.Xs("SettingsPage")})};wU.prototype.Iy=function(){(0,window.$)(window).on("beforeunload.SettingsPage",(0,z.t)(function(){return"浣犵殑淇敼杩樻湭淇濆瓨锛岀‘璁ょ寮€璇ラ〉闈㈠悧锛�"},this))};wU.prototype.Xs=function(){(0,window.$)(window).off("beforeunload.SettingsPage")};z.x("ZH.entrySettings",function(){(new wU).init()});z.x("ZH.entrySettingsAccount",function(){var a=new iU;a.w((0,window.$)(".settings-acount-main")[0]);return a});z.lg("page-settings");}).call(this, __z_z__);
//# sourceURL=/static/revved/-/js/closure/page-settings.593cf149.js